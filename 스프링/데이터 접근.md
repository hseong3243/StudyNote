#### JDBC
---
JDBC는 자바에서 데이터베이스에 접속할 수 있도록 하는 자바 API입니다. JDBC는 데이터베이스에 쿼리하거나 업데이트하는 방법을 제공합니다. 각각의 DB 벤더 사들은 해당 인터페이스를 구현한 라이브러리를 제공하며 이를 JDBC 드라이버라 합니다.

#### 커넥션 풀
---
애플리케이션에서 DB에 접근하기 위해 요청마다 커넥션을 생성하는 것은 비용이 많이 드는 작업입니다. 이를 해결해주는 것이 커넥션 풀입니다. 커넥션을 미리 생성해두고 필요할 때마다 하나씩 꺼내 쓴 뒤 작업이 종료되면 커넥션 풀에 다시 반환합니다.

여러 커넥션 풀 오픈소스가 있으며 스프링 부트가 기본으로 사용하는 커넥션 풀은 `hikariCP`입니다.

#### DataSource
---
`DataSource`는 커넥션을 획득하는 방법을 추상화한 인터페이스입니다. 이를 이용하여 개발자는 커넥션이 `DriverManager`를 통해 만들어지는지, 커넥션 풀을 통해 획득하는지 전혀 알 필요 없이 커넥션을 획득하고, 사용하고, 종료하면 됩니다.

#### 스프링의 트랜잭션 추상화
---
스프링은 트랜잭션을 획득하는 방법을 추상화한 인터페이스인 `PlatformTransactionManager`를 제공합니다.
![[스프링 트랜잭션 추상화.png]]
<출처: 김영한님의 스프링 DB 1편>

스프링은 트랜잭션 동기화 매니저를 제공합니다. 트랜잭션 동기화 매니저는 쓰레드 로컬을 이용하여 멀티쓰레드 상황에서 안전하게 커넥션을 동기화할 수 있습니다.
![[트랜잭션 동기화 매니저.png]]
<출처: 김영한님의 스프링 DB 1편>

트랜잭션 매니저는 데이터소스를 통해 커넥션을 획득하고 트랜잭션을 시작합니다. 트랜잭션 매니저는 커넥션을 트랜잭션 동기화 매니저에 보관하고 데이터 접근 로직에서 보관된 커넥션을 이용합니다. 트랜잭션이 종료되면 트랜잭션 매니저는 동기화 매니저에 있는 커넥션을 통해 트랜잭션을 종료하고 커넥션을 반환합니다.

#### 트랜잭션 AOP
---
스프링은 AOP 기능을 이용한 프록시를 통해 트랜잭션 획득하고 반환하기 위한 공통 로직을 제거할 수 있습니다. 개발자는 트랜잭션이 필요한 곳에 `@Transactional` 어노테이션만 붙여주면 됩니다.
![[트랜잭션 AOP.png]]
<출처: 김영한님의 스프링 DB 1편>

`@Transactional`을 메서드나 클래스에 붙이면 해당 객체 대신 트랜잭션을 처리해주는 프록시 객체가 스프링 빈에 등록됩니다. 프록시 객체는 내부에 실제 객체에 대한 참조를 가지고 있습니다.
##### 프록시 내부 호출
프록시 객체가 참조하고 있는 실제 객체에서 내부 호출이 발생하는 경우 프록시를 거치지 않고 곧바로 실제 객체를 호출하게 됩니다. 이 경우 `@Transactional`이 있어도 적용되지 않습니다.
![[프록시 내부 호출.png]]
<출처: 김영한님의 스프링 DB 2편>
##### 예외 발생시
스프링 트랜잭션의 예외가 발생하면 체크 예외, 언체크 예외에 따라 서로 다른 동작이 발생합니다.
- 언체크 예외 발생시 롤백합니다.
- 체크 예외 발생시 커밋합니다.

이러한 예외에 따른 동작은 `rollbackFor`, `noRollbackFor` 옵션을 통해 변경할 수 있습니다.

체크 예외가 정상적으로 커밋하는 이유는 스프링이 체크 예외를 비즈니스적인 의미가 있다고 가정하고 언체크 예외는 복구 불가능한 예외로 가정하기 때문입니다.
##### @Transactional(readOnly = true)
`readOnly=true` 옵션을 사용하면 읽기 전용 트랜잭션이 생성됩니다. 등록, 수정, 삭제가 불가하고 오직 읽기 기능만 작동합니다. 또한 커밋 시점에 플러시를 호출하지 않고 변경 감지를 위한 스냅샵을 저장하지 않기 때문에 성능 최적화가 발생합니다.

## 참고
---
김영한님의 스프링 DB