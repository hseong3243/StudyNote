의존성 역전 원칙은 구체적인 것보다는 추상적인 것에 의존하라는 원칙입니다. 물론 `String`과 같은 구체 클래스는 예외입니다. `String`은 매우 안정적이며 설령 변경이 발생하더라도 엄격한 통제하에서 일어납니다. 때문에 이러한 안정성이 보장된 환경에 의존하는 것은 용납되는 편입니다.

우리가 의존하지 않도록 피해야 하는 것은 변동성이 큰 구현체들입니다. 새로운 요구사항이 추가되거나 개발중에 언제든지 변경될 수 있는 모듈들에 대해서 의존하는 것은 피해야 합니다.

## 왜 의존성 역전 원칙을 준수해야 하는가?
`Movie`라는 클래스가 있습니다. `Movie`는 영화 요금의 계산을 위해서 `PercentDiscountPolicy`라는 클래스에 의존하고 있습니다. `PercentDiscountPolicy`는 할인조건에 해당하는 경우 일정 퍼센트만큼 차감해야할 금액을 `Movie`에게 반환해줍니다.
![[구체 클래스 의존성.png]]

어느날 새로운 요구사항이 추가되었습니다. 기존에는 조건에 해당하는 사람들만 일정 퍼센트만큼 할인해주던 것에서 모든 관람객들을 대상으로 1,000원 씩 할인해주는 이벤트를 진행하기로 하였습니다. 개발자는 새로운 요구사항을 구현하기 위해 `AmountDiscountPolicy` 클래스를 추가합니다. 또한, `Movie`가 영화 금액을 계산하기 위해 협력하는 객체를 변경하기 위해 코드를 변경해야 합니다.
```java
public class Movie {

//	private final PercentDiscountPolicy discountPolicy;
	private final AmountDiscountPolicy discountPolicy;

	public Movie(...) {
		...
//		this.discountPolicy = new PercentDiscountPolicy(...);
		this.discountPolicy = new AmountDiscountPolicy(...);
	}

	...

	private Money calculateFee(...) {
		int discountAmount = discountPolicy.calculateDiscountAmount(...);
		...
	}
}
```

이처럼 구체적인 것에 대한 의존은 변경에 유연하게 대응할 수 있는 가능성을 없애버립니다. `Movie`는 오직 일정 퍼센트 할인이라는 문맥에서만 작동하고 일정 금액 할인이라는 문맥에서는 사용할 수 없습니다. `Movie`를 재사용하기 위해서는 내부 구현을 변경해야만 합니다. 그러나 새로운 요구사항이 추가될 때마다 내부 구현을 변경해야 한다면 그러한 의존성은 올바르지 못한 의존성입니다.

올바른 의존성으로 바꾸기 위해서는 보다 추상적인 것에 의존하도록 해야합니다. 일정 퍼센트 할인과 일정 금액 할인이라는 문맥으로부터 할인 요금 계산이라는 추상적인 역할만 추출하여 이것에만 의존하도록 만들어야 합니다.
```java
public class Movie {

	private final DiscountPolicy discountPolicy;

	public Movie(..., DiscountPolicy discountPolicy) {
		...
		this.discountPolicy = discountPolicy;
	}

	...

	private Money calculateFee(...) {
		int discountAmount = discountPolicy.calculateDiscountAmount(...);
		...
	}
}
```

이제 `Movie`는 할인 요금 계산이라는 메시지만 노출하는 추상적인 `DiscountPolicy`에 의존합니다. 또한, 생성자를 통해서 의존성을 드러내고 런타임에 주입받음으로써 할인 요금 계산을 수행하는 다양한 `DiscountPolicy` 인스턴스들과 협력할 수 있습니다.
![[추상 클래스 의존성.png]]

컴파일타임에 `Movie`는 추상적인 `DiscountPolicy`에 의존하고 런타임에는 구체적인 `AmountDiscountPolicy`를 의존합니다. 이렇게 소스 코드의 의존성이 제어흐름과 반대 방향으로 역전되는 것을 의존성 역전이라 합니다. 우리는 이를 통하여 새로운 요구사항이 추가되더라도 변경에 유연하게 대응할 수 있습니다. 

오브젝트에서 설명하는 바에 따르면 의존성 역전 원리는 전통적인 설계 방법과 객체지향을 구분하는 가장 핵심적인 원리라고 말하고 있습니다. 요구사항이 빠르게 진화하는 코드에서 의존성 역전 원리가 지켜지고 있지 않다면 이는 변경을 적절하게 수용할 수 없는 절차적인 코드가 존재할 수밖에 없다고 설명하고 있습니다.
