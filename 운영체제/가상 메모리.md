#### 가상 메모리
---
가상 메모리는 크기가 다른 물리 메모리에서 일관되게 프로세스를 실행할 수 있는 기술입니다. 스왑 영역을 이용하여 물리 메모리가 가득 차면 일부 프로세스를 스왑 영역으로 보내고(스왑아웃) 몇 개의 프로세스가 종료되면 프로세스를 메모리로 가져옵니다(스왑인).

가상 메모리 시스템에서 가상 주소는 물리 메모리나 스왑 영역 중 한 곳에 위치합니다. 메모리 관리자는 가상 주소와 물리 주소를 일대일로 매핑한 테이블로 관리합니다.

##### 지역성
지역성은 기억장치에 접근하는 패턴이 메모리 전체에 분포되는 것이 아닌 특정 영역에 집중되는 성질을 말합니다.

- 공간의 지역성
	현재 위치에서 가까운 데이터에 접근할 확률이 높음을 의미합니다.
- 시간의 지역성
	현재를 기준으로 가장 가까운 시간에 접근한 데이터가 사용될 확률이 높음을 의미합니다.
- 순차적 지역성
	작업이 순서대로 진행되는 것을 의미합니다.

#### 페이징 기법
---
페이징 기법은 고정 분할 방식을 이용한 가상 메모리 관리 기법입니다. 가상 주소의 분할된 각 영역을 페이지(page)라고 부르며 번호를 매겨 관리합니다. 물리 메모리의 각 영역은 가상 주소의 페이지와 구분하기 위해 프레임(frame)이라고 부릅니다. 페이지와 프레임의 크기는 동일합니다.

페이지 테이블은 하나의 열로 구성되며 위에서부터 차례로 페이지 0과 연결되는 프레임 번호가 있습니다. 각 프로세스는 운영체제 영역에 존재하는 페이지 테이블에 빠르게 접근하기 위한 페이지 테이블 기준 레지스터(PTBR)을 가집니다.

##### 쓰기 시점 복사
프로세스를 복사하면 공유할 수 있는 프레임과 공유할 수 없는 프레임이 있습니다. 운영체제는 필요한 순간까지 공유할 수 없는 데이터를 위한 메모리 공간을 확보를 미루다가 필요한 순간 새로운 프레임을 확보합니다. 이를 쓰기 시점 복사라합니다.

##### 변환 색인 버퍼(Translation Look-ahead Buffer)
변환 색인 버퍼는 캐시 시스템과 유사합니다. 지역성 이론에 근거하여 현재 사용 중이거나 사용이 예상되는 페이지를 CPU 안으로 가져오는데 이를 변환 색인 버퍼라 합니다.

##### 다단계 페이지 테이블
비트 수가 발전함에 따라 사용할 수 있는 주소 공간이 늘어나고 페이지 테이블의 크기 역시 늘어났습니다. 이를 편하게 관리하기 위해 등장한 것이 다단계 페이지 테이블입니다.

크기가 큰 페이지 테이블을 같은 크기의 묶음으로 나누어 효율적으로 관리할 수 있습니다.

#### 세그먼테이션 기법
---
가변 분할 방식을 이용한 가상 메모리 관리 기법으로 물리 메모리를 프로세스 크기에 따라 가변적으로 나누어 사용합니다. 페이징 기법과 마찬가지로 가상 주소를 물리 주소로 변환하는데 세그먼테이션 테이블을 사용합니다.

세그먼테이션 기법의 장점은 프로세스 단위로 메모리를 관리하기 때문에 세그먼테이션 테이블이 작고 단순해진다는 것이지만 물리 메모리의 외부 단편화로 관리가 복잡해집니다.

세그먼테이션 테이블에는 세그먼트의 크기를 나타내는 limit와 물리 메모리의 시작 주소를 나타내는 address가 있습니다. limit는 메모리를 보호하는 역할을 하며 사용자가 크기보다 더 큰 주소에 접근하려고하면 메모리 관리자는 해당 프로세스를 강제 종료합니다.

#### 요구 페이징
---
요구 페이징은 프로세스가 요청할 때 프로세스가 필요로 하는 데이터를 메모리로 가져오는 것을 말합니다.

페이지 테이블의 한 행을 페이지 테이블 엔트(PTE)라고 하며 플래그 비트와 프레임 번호(주소 필드)로 구성되어 있습니다. 플래그 비트는 다음과 같이 구성되어 있습니다.

- 접근 비트(참조 비트): 페이지가 메모리에 올라온 후 사용한 적이 있는지
- 변경 비트(더티 비트): 페이지가 메모리에 올라온 후 변경이 있었는지
- 유효 비트(현재 비트): 페이지가 실제 메모리에 있는지
- 읽기, 쓰기, 실행 비트(접근 권한 비트)

##### 페이지 부재(Page fault)
프로세스가 페이지를 요청했을 때 그 페이지가 메모리에 없는 상황을 페이지 부재라고 합니다. 페이지 부재가 발생하면 페이지 교체 알고리즘에 따라 어떤 페이지를 스왑 영역으로 보낼지 결정합니다.

#### 페이지 교체 알고리즘
---
페이지 교체 알고리즘에는 간단한 무작위, FIFO 알고리즘, 이론적 알고리즘인 최적 알고리즘, 최적 근접 알고리즘인 LRU, LFU, NUR, FIFO 변형이 있습니다.

##### LRU(Least Recently Used, 가장 최근에 덜 사용한 페이지)
LRU는 페이지에 접근한 시간을 기준으로 대상 페이지를 선정합니다. 현재를 기준으로 가장 과거에 사용한 페이지를 스왑 영역으로 보냅니다.

##### LFU(Least Frequently Used, 덜 빈번하게 사용한 페이지)
LFU는 페이지가 몇 번 사용되었는지를 기준으로 대상 페이지를 선정합니다. 프레임에 있는 페이지마다 사용된 횟수를 세어 가장 적은 페이지를 스왑 영역으로 보냅니다.

##### NUR(Not Used Recently, 최근 미사용 페이지)
참조 비트와 변경 비트를 이용하여 가장 최근에 사용되지 않은 페이지를 스왑 영역으로 보냅니다. 모든 프레임의 참조, 변경 비트가 11이 되면 모든 페이지 비트를 00으로 초기화합니다.

LRU, LFU, NUR 알고리즘은 성능은 거의 비슷하지만 NUR 알고리즘이 2bit만 추가하여 다른 알고리즘과 유사한 성능을 낼 수 있고 쉽게 구현 가능하여 가장 많이 사용되고 있습니다.

#### 스레싱(threshing)
---
하드디스크의 입출력이 너무 많아 잦은 페이지 부재로 작업이 멈춘 것 같은 상태를 스레싱이라 합니다.

동시에 실행하는 프로그램의 수를 멀티프로그래밍 정도(degree of multiprogramming)이라고 하며 이 정도가 너무 높아지면 스레싱이 발생합니다. 

스레싱은 각 프로세스에 프레임을 얼만나 나누어 주는지에도 연관되어 있습니다. 너무 많은 프레임을 할당하여 페이지 부재는 줄었지만 물리 메모리를 낭비하면 전반적인 시스템 성능이 줄어들 수 있습니다. 반대로 너무 적은 프레임을 할당하면 빈번한 페이지 부재가 발생합니다.

##### 정적 할당
정적 할당 방식은 실행 초기에 프레임을 나누어준 후 크기를 고정하는 방식입니다. 정적 할당 방식은 균등 할당과 비례 할당이 있습니다.

##### 동적 할당
동적 할당은 작업집합 모델과 페이지 부재 빈도를 사용하는 방식이 있습니다.

- 작업집합 모델(working set model)
	지역성 이론을 바탕으로 하며 가장 최근에 접근한 프레임이 이후에도 참조될 가능성이 높다는 가정에서 출발합니다. 최근 일정 시간동안 참조된 페이지들을 집합(working set)으로 만들고 이를 물리 메모리에 유지하여 프로세스 실행을 돕습니다.
	작업 집합 윈도의 크기에 따라 프로세스의 실행 성능이 달라집니다.
- 페이지 부재 빈도(page fault frequency)
	페이지 부재 횟수를 기록하여 페이지 부재 비율을 계산하고 부재 비율의 상한선과 하한선을 설정합니다. 상한선을 초과하면 프레임을 추가로 할당하고 하한선 밑으로 내려가면 할당한 프레임을 회수합니다.

