```groovy
import static net.grinder.script.Grinder.grinder
import static org.junit.Assert.*
import static org.hamcrest.Matchers.*
import net.grinder.script.GTest
import net.grinder.script.Grinder
import net.grinder.scriptengine.groovy.junit.GrinderRunner
import net.grinder.scriptengine.groovy.junit.annotation.BeforeProcess
import net.grinder.scriptengine.groovy.junit.annotation.BeforeThread
// import static net.grinder.util.GrinderUtils.* // You can use this if you're using nGrinder after 3.2.3
import org.junit.Before
import org.junit.BeforeClass
import org.junit.Test
import org.junit.runner.RunWith

import org.ngrinder.http.HTTPRequest
import org.ngrinder.http.HTTPRequestControl
import org.ngrinder.http.HTTPResponse
import org.ngrinder.http.cookie.Cookie
import org.ngrinder.http.cookie.CookieManager

import groovy.json.JsonSlurper

/**
* A simple example using the HTTP plugin that shows the retrieval of a single page via HTTP.
*
* This script is automatically generated by ngrinder.
*
* @author admin
*/
@RunWith(GrinderRunner)
class TestRunner {

	public static GTest test1
	public static GTest test2
	public static GTest test3
	public static String authorization
	public static String linkBundleId
	public static HTTPRequest request
	public static Map<String, String> headers = [:]
	public static Map<String, Object> params = [:]
	public static String body = "{\n\"email\": \"hseong3243@gmail.com\",\n\"password\": \"gksrmf@3394\"\n}"
	public static List<Cookie> cookies = []

	@BeforeProcess
	public static void beforeProcess() {
		HTTPRequestControl.setConnectionTimeout(300000)
		test1 = new GTest(1, "POST /api/login")
		test2 = new GTest(2, "GET /api/link-bundles")
		test3 = new GTest(3, "GET /api/links")
		request = new HTTPRequest()

		// Set header data
		headers.put("Content-Type", "application/json")
		grinder.logger.info("before process.")
	}

	@BeforeThread
	public void beforeThread() {
		test1.record(this, "test1")
		test2.record(this, "test2")
		test3.record(this, "test3")
		grinder.statistics.delayReports = true
		grinder.logger.info("before thread.")
	}

	@Before
	public void before() {
		request.setHeaders(headers)
		CookieManager.addCookies(cookies)
		grinder.logger.info("before. init headers and cookies")
	}

	@Test
	public void test1() {
		HTTPResponse response = request.POST("https://api.shoutlink.me/api/login", body.getBytes())
		
		def result = new JsonSlurper().parseText(response.getBodyText())
		grinder.logger.info("data={}", result.accessToken)
		authorization = "Bearer " + result.accessToken
		headers.put("Authorization", authorization)
		
		if (response.statusCode == 301 || response.statusCode == 302) {
			grinder.logger.warn("Warning. The response may not be correct. The response code was {}.", response.statusCode)
		} else {
			assertThat(response.statusCode, is(200))
		}
	}
	
	@Test
	public void test2() {
		HTTPResponse response = request.GET("https://api.shoutlink.me/api/link-bundles", params)
		def result = new JsonSlurper().parseText(response.getBodyText())
		grinder.logger.info("data={}", result)
		linkBundleId = result.linkBundles[0].linkBundleId
		grinder.logger.info("linkBundleId={}", linkBundleId)
		
		if (response.statusCode == 301 || response.statusCode == 302) {
			grinder.logger.warn("Warning. The response may not be correct. The response code was {}.", response.statusCode)
		} else {
			assertThat(response.statusCode, is(200))
		}
	}
	
	@Test
	public void test3() {
		params.put("linkBundleId", linkBundleId)
		HTTPResponse response = request.GET("https://api.shoutlink.me/api/links", params)

		def result = new JsonSlurper().parseText(response.getBodyText())
		grinder.logger.info("data={}", result)
		
		if (response.statusCode == 301 || response.statusCode == 302) {
			grinder.logger.warn("Warning. The response may not be correct. The response code was {}.", response.statusCode)
		} else {
			assertThat(response.statusCode, is(200))
		}
	}
}

```

#### 주요 포인트
새로운 `GTest` 인스턴스를 생성하면 여러 트랜잭션을 기록할 수 있습니다.
```groovy
	public static GTest test1
	public static GTest test2
	public static GTest test3
	//...

	@BeforeProcess
	public static void beforeProcess() {
		//...
		test1 = new GTest(1, "POST /api/login")
		test2 = new GTest(2, "GET /api/link-bundles")
		test3 = new GTest(3, "GET /api/links")
		//...
	}

	@BeforeThread
	public void beforeThread() {
		test1.record(this, "test1")
		test2.record(this, "test2")
		test3.record(this, "test3")
		//...
	}
	
	@Test
	public void test1() { ... }
	
	@Test
	public void test2() { ... }
	
	@Test
	public void test3() { ... }
```

`JsonSlurper`는 JSON 텍스트를 Groovy 데이터 구조로 구문 분석하는 클래스입니다. 다음과 같이 요청의 결과를 파싱하여 다음 트랜잭션의 요청에 활용할 수 있습니다.
```groovy
import groovy.json.JsonSlurper

//...
	@Test
	public void test() {
		HTTPResponse response = request.GET("https://api.shoutlink.me/api/link-bundles", params)
		def result = new JsonSlurper().parseText(response.getBodyText())
		grinder.logger.info("data={}", result)
		linkBundleId = result.linkBundles[0].linkBundleId
		params.put("linkBundleId", linkBundleId)
		//...
	}
//...
```

#### 참고
https://groovy-lang.org/processing-json.html
https://github.com/naver/ngrinder/wiki/The-New-nGrinder-HTTP-Client