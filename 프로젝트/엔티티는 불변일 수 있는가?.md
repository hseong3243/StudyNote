## 개요
---
애니프렌즈 프로젝트 진행 중 엔티티를 불변으로 하는 것이 어떻느냐는 의견이 나왔습니다. 저는 해당 의견에 대해서 반대했습니다. 
엔티티의 상태를 나타내는데 사용하고 있는 vo는 불변으로 둬야 하나 엔티티는 불변으로 두지 않는다가 저의 의견이었습니다. 그러나 4명의 팀원 중 3명이 동의하였고 다수결에 따라 엔티티를 불변으로 놓고 작업을 진행하였습니다.
그리고 이틀이 지난 시점, 엔티티 불변이라는 개념을 받아들이지 못해 다시 한 번 팀원들에게 저의 의견을 전달하였습니다. 결국 엔티티는 가변, vo는 불변으로 가는 것으로 팀의 방침이 변경되었습니다.
이번 게시글에서는 제가 이러한 엔티티는 불변일 수 없다. 라는 의견을 가지게 이유에 대해 정리를 하고자 합니다.
현재 제가 가지고 있는 지식만을 토대로 정리한 생각이기에 틀리거나 부족한 부분이 있을 수 있습니다. 너른 마음으로 지적 부탁드립니다.

## 값 객체와 엔티티
---
값 객체(Value Object), vo는 이름 그대로 값을 나타내는 객체입니다. 이들은 객체이기 때문에 서로 다른 엔티티간에 참조될 위험을 가지고 있습니다. 그렇기에 불변으로 관리되어야 하며 다른 값으로 변경 되어야 하는 경우 새로운 vo를 생성해서 안전하게 사용해야 합니다.

그러나 엔티티를 불변으로 두는 것은 개념적으로 받아들이기 힘듭니다.

엔티티는 vo와 다릅니다. vo는 별다른 행위 없이 단순한 값을 나타냅니다. 엔티티는 상태와 행위를 가지고 있습니다. 행위를 통해 엔티티가 가진 상태가 변경됩니다.

클라이언트가 엔티티에게 `새로운 값으로 업데이트해라` 라면서 어떤 값을 넘겨준다고 해보겠습니다.

가변적인 엔티티는 스스로가 정한 최적의 방법을 이용하여 자신의 상태를 업데이트 합니다. 그리고 클라이언트는 여전히 그 엔티티를 알고 있습니다. 변경되기 전의 엔티티와 변경된 후의 엔티티는 동일한 엔티티입니다.

불변 엔티티는 자신의 상태를 업데이트 하지 않습니다. `새로운 값으로 업데이트해라`라는 메시지를 보낸 클라이언트에게 새로운 엔티티를 반환합니다. 클라이언트는 메시지를 보낸 `원본 엔티티`와 원본 엔티티 메시지의 응답으로 반환한 `새로운 엔티티`를 가지고 있게 됩니다.

내가 값을 변경해라라고 메시지를 보낸 것은 `원본 엔티티`입니다. 클라이언트가 기대하는 것은 원본 엔티티가 자신의 상태를 변경하는 행위를 수행하는 것입니다. 변경 전의 엔티티와 변경 후의 엔티티는 동일한 엔티티여야합니다.

기본키가 같다고 해서 동일한 엔티티라고 생각하지 않습니다. 이는 데이터 의존적인 시각이라고 생각합니다. 서비스 객체가 클라이언트라고 한다면 해당 메시지를 전송하는 로직은 동일하지 않은, 서로 다른 엔티티 2개를 로직에서 가지고 있게 됩니다.

엔티티를 불변으로 관리하는 사람들이 있다면 분명 어떤 이유가 있을겁니다. 그러나 저는 그 이유를 알지 못하고 지금 제가 가지고 있는 지식과 충돌하는 부분이 많습니다.

개념적인 부분뿐만 아니라 로직 또한 받아들이기 어렵습니다. 엔티티를 불변으로 관리하면 당연히 내부에 포함된 vo 또한 불변으로 관리되어야 하기에 `새로운 값으로 업데이트해라`라는 메시지를 보냈을 뿐인데 전혀 상관없는 필드까지도 새로운 vo를 만들어주어야 합니다. 저는 이러한 로직 받아들이지 못하겠습니다.